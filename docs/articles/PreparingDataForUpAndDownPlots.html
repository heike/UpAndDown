<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preparing data for UpAndDown plots • UpAndDownPlots</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Preparing data for UpAndDown plots">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">UpAndDownPlots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DrawingUpAndDownPlots.html">Drawing UpAndDown plots</a>
    </li>
    <li>
      <a href="../articles/NestingYesOrNo.html">Nesting, Yes or No?</a>
    </li>
    <li>
      <a href="../articles/PreparingDataForUpAndDownPlots.html">Preparing data for UpAndDown plots</a>
    </li>
    <li>
      <a href="../articles/Sortings.html">Sortings</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Preparing data for UpAndDown plots</h1>
                        <h4 class="author">Antony Unwin</h4>
            
            <h4 class="date">2020-01-28</h4>
      
      
      <div class="hidden name"><code>PreparingDataForUpAndDownPlots.Rmd</code></div>

    </div>

    
    
<div id="data-to-be-displayed" class="section level2">
<h2 class="hasAnchor">
<a href="#data-to-be-displayed" class="anchor"></a>Data to be displayed</h2>
<p>UpAndDown plots show percentage and absolute changes for subgroups at different levels. The package needs initial and final values for each item and (possibly) a weight variable measuring how important each item is. Here is an example from the German car sales data set (<code>AutoSales</code>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(UpAndDownPlots)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" title="3">yy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSales, <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Segment"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb1-4" title="4">y1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(yy, <span class="dt">labelvar=</span><span class="st">"Segment"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">y1<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="PreparingDataForUpAndDownPlots_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 1: An UpAndDown plot of vehicle sales by market segment. SUVs had the biggest increase both in percentage and volume. Vans, Intermediates, and Compacts all lost ground.</p>
<p>Consider looking at which manufacturers did best. Running the following code generates an error message showing that at least one manufacturer had no sales in 2017.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">yv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSales, <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Manufacturer"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"perc"</span>))</a></code></pre></div>
<p>This code shows which manufacturers had zero initial sales.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">AutoSales0 &lt;-<span class="st"> </span>AutoSales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Manufacturer) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">Sales17=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(sales17)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(Sales17<span class="op">==</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">AutoSales0</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   Manufacturer Sales17
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 ALPINE             0</code></pre>
<p>Apart from Alpine, several manufacturers may have had low sales and then big percentage changes. The next plot sorts by sales in 2017 to place the smaller manufacturers at one end. It also limits the range of percentage changes to between -20% and +20% (although larger changes will be drawn if they can be fit on the plot).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">yv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(<span class="op">!</span>(Manufacturer<span class="op">==</span><span class="st">"ALPINE"</span>)), <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Manufacturer"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"base"</span>))</a>
<a class="sourceLine" id="cb5-2" title="2">y2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(yv, <span class="dt">labelvar=</span><span class="st">"Manufacturer"</span>, <span class="dt">vscale=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</a>
<a class="sourceLine" id="cb5-3" title="3">y2<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="PreparingDataForUpAndDownPlots_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 2: Percentage change in numbers of vehicles sold by manufacturer, comparing figures for 2018 with figures for 2017, sorting by sales in 2017. In percentage terms Audi and Opel did badly amongst the larger companies while Ford did best. Nissan did particularly badly amongst the medium-sized companies, while Seat did very well.</p>
<p>Notice in Figure 2 how the percentage changes tend to increase as the companies get smaller. A warning message says that 8 rectangles could not be drawn, meaning 8 percentage changes were too big to fit on the plot. There is not space for all the manufacturer names as labels, but this only affects the companies with small initial sales in Figure 2.</p>
</div>
<div id="data-difficulties-and-their-resolution" class="section level2">
<h2 class="hasAnchor">
<a href="#data-difficulties-and-their-resolution" class="anchor"></a>Data difficulties and their resolution</h2>
<p>When a new car is introduced, the initial sales might be zero or low and the final sales high (e.g., the Volvo XC40 jumped from sales of 14 to sales of 6898). Infinite or extreme percentage changes cannot be accurately shown. Vehicles with the same name can be sold in two different market segments (e.g., Renault Trafic in both MobileHomes and Utilities). Sometimes a vehicle is reclassified (e.g., the BMW X4 was switched from SUV to Off-road in April 2018). Manufacturers may leave a sector and offer a vehicle in another (e.g., the Opel Meriva was a MiniVan and the Opel Crossland X is an SUV). Occasionally values may be missing for some reason or other.</p>
<p>If any of these difficulties, or indeed others, arise, they have to be dealt with before drawing final graphics. Most of the issues with <code>AutoSales</code> concern vehicles with low initial and final sales and they can be grouped into an “Others” category. As usual when discussing how to deal with messy real data, you can never be sure that the next dataset will not have some new problem that you have not met before. Each must be handled on its own merits.</p>
</div>
<div id="examples-using-the-reduced-autosalesx-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-using-the-reduced-autosalesx-dataset" class="anchor"></a>Examples using the reduced AutoSalesX dataset</h2>
<p>The fuller version of the German car sales data set (<code>AutoSales</code>) offers several examples of the difficulties there can be. For the <code>AutoSalesX</code> dataset, vehicles selling less than 1000 in either year have been reclassified as ‘Other’ and the data have been aggregated by manufacturer within segments, so there are no sales for individual models.</p>
<p>Now you can look at sales by manufacturer within segments. The next figure shows that there are still difficulties.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">yw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSalesX, <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Segment"</span>, <span class="st">"Manufacturer"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"perc"</span>, <span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb6-2" title="2">y3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(yw, <span class="dt">labelvar=</span><span class="st">"Segment"</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">y3<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="PreparingDataForUpAndDownPlots_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 3: Percentage changes by manufacturer within segment. Three manufacturers have increases of over 400% within a segment, even though Figure 2 shows that overall increases for manufacturers were generally much lower.</p>
<p>The top ten percentage changes in the figure can be found using</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">arrange</span>(y3<span class="op">$</span>level2, <span class="kw">desc</span>(percCh)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Segment    Manufacturer percCh
##    &lt;fct&gt;      &lt;fct&gt;         &lt;dbl&gt;
##  1 SUV        VW           1807. 
##  2 SUV        SKODA         803. 
##  3 Off-road   OTHER         437. 
##  4 Mini       PEUGEOT       127. 
##  5 SUV        OTHER         111. 
##  6 MobileHome CITROEN        65.2
##  7 MobileHome PEUGEOT        63.2
##  8 SUV        ALFA ROMEO     50.6
##  9 SUV        HYUNDAI        49.6
## 10 SUV        DACIA          43.8</code></pre>
<p>The biggest change is due to VW introducing the T-ROC SUV in August 2017. Sales up to the end of that year are recorded as 1851 with 35299 in 2018. Many people would say that the VW Tiguan and VW Touareg are SUVs, but the KBA report them in the Off-road sector. Working with market share data is interesting but problematic. Solutions can be to combine segments or to look at individual segments. It depends what the aims of the analyses are.</p>
<p>Combining the <code>SUV</code> and <code>Off-road</code> segments is shown in Figure 4.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">yz &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSalesX <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(Segment <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Off-road"</span>, <span class="st">"SUV"</span>)), <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Manufacturer"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"base"</span>))</a>
<a class="sourceLine" id="cb9-2" title="2">y4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(yz, <span class="dt">labelvar=</span><span class="st">"Manufacturer"</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">y4<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="PreparingDataForUpAndDownPlots_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 4: Percentage changes for the combined segments <code>Off-road</code> and <code>SUV</code>. There are big increases for SKODA because of a new model replacing an older one, a switch that was missed by the way this reduced dataset was constructed and for <code>OTHER</code>, because many new vehicles came out.</p>
<p>Figure 5 shows the biggest segment, <code>Compact</code>, on its own. There are no dramatic increases in this declining segment, so there are no issues and the plot gives a good overview.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">yx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(AutoSalesX <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(Segment<span class="op">==</span><span class="st">"Compact"</span>), <span class="dt">v1=</span><span class="st">"sales17"</span>, <span class="dt">v2=</span><span class="st">"sales18"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Manufacturer"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"base"</span>))</a>
<a class="sourceLine" id="cb10-2" title="2">y5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(yx, <span class="dt">labelvar=</span><span class="st">"Manufacturer"</span>)</a>
<a class="sourceLine" id="cb10-3" title="3">y5<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="PreparingDataForUpAndDownPlots_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 5: Percentage changes in the <code>Compact</code> segment. The whole segment declined and of the bigger manufacturers only Mercedes and Ford had year-on-year increases.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-to-be-displayed">Data to be displayed</a></li>
      <li><a href="#data-difficulties-and-their-resolution">Data difficulties and their resolution</a></li>
      <li><a href="#examples-using-the-reduced-autosalesx-dataset">Examples using the reduced AutoSalesX dataset</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Antony Unwin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
