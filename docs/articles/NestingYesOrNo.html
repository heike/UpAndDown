<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nesting, Yes or No? • UpAndDownPlots</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Nesting, Yes or No?">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">UpAndDownPlots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DrawingUpAndDownPlots.html">Drawing UpAndDown plots</a>
    </li>
    <li>
      <a href="../articles/NestingYesOrNo.html">Nesting, Yes or No?</a>
    </li>
    <li>
      <a href="../articles/PreparingDataForUpAndDownPlots.html">Preparing data for UpAndDown plots</a>
    </li>
    <li>
      <a href="../articles/Sortings.html">Sortings</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Nesting, Yes or No?</h1>
                        <h4 class="author">Antony Unwin</h4>
            
            <h4 class="date">2020-02-27</h4>
      
      
      <div class="hidden name"><code>NestingYesOrNo.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Grouping variables define subgroups of the data. If there are several grouping variables they can be nested like the subsectors of sectors in the UK CPI data (the <code>CPIuk</code> dataset) or not nested like age, gender, area in the Northern Ireland population data (the <code>NIpop</code> dataset). In fact, with NIpop there can be a mixture of nesting and non-nesting. The variable <code>area_name</code> representing 80 District Electoral Areas is nested within the variable <code>LGD2014_name</code> representing 11 Local Government Districts. This is shown in the next figure.</p>
</div>
<div id="a-nested-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#a-nested-plot" class="anchor"></a>A nested plot</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(UpAndDownPlots)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" title="3">kk &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(NIpop, <span class="dt">v1=</span><span class="st">"y2011"</span>, <span class="dt">v2=</span><span class="st">"y2017"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"LGD2014_name"</span>, <span class="st">"area_name"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"perc"</span>, <span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb1-4" title="4">k1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(kk, <span class="dt">labelvar=</span><span class="st">"LGD2014_name"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">k1<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="NestingYesOrNo_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 1: All LGD’s increased in population over the six years and only a few areas recorded decreases. Belfast, the largest LGD, had the second lowest increase, with Derry having the lowest. The sorting of areas within districts by percentage change makes it easier to see the nesting.</p>
</div>
<div id="a-non-nested-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#a-non-nested-plot" class="anchor"></a>A non-nested plot</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">km &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(NIpop, <span class="dt">v1=</span><span class="st">"y2011"</span>, <span class="dt">v2=</span><span class="st">"y2017"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"LGD2014_name"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"perc"</span>, <span class="st">"orig"</span>, <span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb2-2" title="2">k2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(km, <span class="dt">labelvar=</span><span class="st">"age"</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">k2<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="NestingYesOrNo_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 2: Changes by district within the age by gender groups. The biggest increases occurred amongst the 65+ males and the biggest decreases amongst the 16-39 females.</p>
<p>The districts are sorted by their overall percentages so the district order is consistent within the individual age by gender groups but the patterns are not. The increases for 65+ are uniformly high with one exception for both genders. The next graphic looks into this.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">kp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(NIpop, <span class="dt">v1=</span><span class="st">"y2011"</span>, <span class="dt">v2=</span><span class="st">"y2017"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"age"</span>, <span class="st">"LGD2014_name"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"orig"</span>, <span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb3-2" title="2">k3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(kp, <span class="dt">labelvar=</span><span class="st">"LGD2014_name"</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">k3<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="NestingYesOrNo_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 3: Percentage changes of districts by age groups with districts sorted by overall percentage change. Belfast is very different in the 65+ group.</p>
</div>
<div id="nesting-and-non-nesting-together" class="section level2">
<h2 class="hasAnchor">
<a href="#nesting-and-non-nesting-together" class="anchor"></a>Nesting and non-nesting together</h2>
<p>The two nested grouping variables, <code>LGD2014_name</code> and <code>area_name</code>, can be used together with one of the non-nested variables like <code>gender</code>. The package assumes that the nested variables are kept together, so that in this situation they would both come before <code>gender</code> or both come after. Figure 4 shows an example.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">kq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_prep.html">ud_prep</a></span>(NIpop, <span class="dt">v1=</span><span class="st">"y2011"</span>, <span class="dt">v2=</span><span class="st">"y2017"</span>, <span class="dt">levs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"gender"</span>, <span class="st">"LGD2014_name"</span>, <span class="st">"area_name"</span>), <span class="dt">sortLev=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"orig"</span>, <span class="st">"perc"</span>, <span class="st">"perc"</span>))</a>
<a class="sourceLine" id="cb4-2" title="2">k4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ud_plot.html">ud_plot</a></span>(kq, <span class="dt">labelvar=</span><span class="st">"LGD2014_name"</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">k4<span class="op">$</span>uadl</a></code></pre></div>
<p><img src="NestingYesOrNo_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fig 4: An UpAndDown plot of areas within districts by <code>gender</code>, males above, females below. The district patterns are broadly similar, although the rate for females in Belfast is lower than for the males.</p>
<p>The patterns in this example are fairly similar, because male and female rates are fairly close. Nevertheless the district percentage changes within <code>gender</code> do not show a regular decline because the districts have been sorted as if they were the only level. This is to ensure that the districts are in the same order for both genders.</p>
</div>
<div id="double-nesting-another-possible-form" class="section level2">
<h2 class="hasAnchor">
<a href="#double-nesting-another-possible-form" class="anchor"></a>Double-nesting – another possible form</h2>
<p>One grouping variable can be separately nested in each of two other grouping variables (“double-nesting”). Take the <code>Car</code> sector of the <code>AutoSales</code> dataset and remove the X4 and OTHER models. The variable <code>Model</code> is then nested in both <code>Segment</code> and <code>Manufacturer</code>. The filtering is necessary because otherwise a few model names are recorded in more than one segment and then the variables appear not to be nested.</p>
<p>The package assumes that any double-nested variable is always last to be drawn and is nested inside the immediately preceding grouping variable.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#a-nested-plot">A nested plot</a></li>
      <li><a href="#a-non-nested-plot">A non-nested plot</a></li>
      <li><a href="#nesting-and-non-nesting-together">Nesting and non-nesting together</a></li>
      <li><a href="#double-nesting-another-possible-form">Double-nesting – another possible form</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Antony Unwin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
